---
import Layout from "../layouts/Layout.astro";
import CandidateList from "../components/candidate/CandidateList.vue";
import { getCandidates } from "../data/get_candidates";
import { getLocationMap, getProvinceList } from "../data/senate_option";
import { ApplicationGroup } from "../data/application_group";
import type { CandidateOverview } from "../data/candidate";

const MAX_TEXT_LENGTH = 80;

const highlightStandpoints = [
	"เขียนรัฐธรรมนูญใหม่ “ทั้งฉบับ”",
	"เขียนรัฐธรรมนูญใหม่ แต่ยกเว้นหมวด 1 หมวด 2",
	"ให้มีสภาร่างรัฐธรรมนูญ (สสร.) ใหม่ จากการเลือกตั้ง100%",
	"ยกเลิกสว. ใช้ระบบสภาเดี่ยว",
	"นิรโทษกรรมคดีการเมือง “ทุกคดี”",
];

const trimLongText = (text: string) =>
	text.length > MAX_TEXT_LENGTH
		? `${text.slice(0, MAX_TEXT_LENGTH).trim()}...`
		: text;

const candidates: CandidateOverview[] = (await getCandidates())
	.map(({ visionQuestionaires, ...rest }) => ({
		...rest,
		education: trimLongText(rest.education),
		occupation: trimLongText(rest.occupation),
		politicalStances: rest.politicalStances.filter(({ statement }) =>
			highlightStandpoints.includes(statement),
		),
	}))
	.sort((a, z) => a.firstName.localeCompare(z.firstName));

const totalCandidate = candidates.length;
const passedCandidate = candidates.filter(
	({ isEliminated }) => !isEliminated,
).length;
const applicationGroup = Object.values(ApplicationGroup);
const provinces = getProvinceList();
const districts = getLocationMap();
---

<Layout title="ค้นหาผู้สมัคร สว.">
	<CandidateList
		{candidates}
		{totalCandidate}
		{passedCandidate}
		{applicationGroup}
		{provinces}
		{districts}
		client:load
	/>
</Layout>
